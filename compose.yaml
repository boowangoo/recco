services:
  recco-web:
    image: recco-web
    build:
      context: ./recco-web/
      dockerfile: recco-web.Dockerfile
    container_name: recco-web
    volumes:
      - ./recco-web/nginx/nginx.conf:/etc/nginx/conf.d/recco-web.conf
      - ./recco-web/nginx/html:/usr/share/nginx/html
      - ./recco-web/nginx/logs:/var/log/nginx
    ports:
      - "8080:80"
    tty: true

  recco-server:
    image: recco-server
    build:
      context: ./recco-server/
      dockerfile: recco-server.Dockerfile
    container_name: recco-server
    volumes:
      - ./recco-server/code:/recco-server
    ports:
      - "8081:80"
    tty: true

  recco-embed:
    image: recco-embed
    build:
      context: ./recco-embed/
      dockerfile: recco-embed.Dockerfile
    container_name: recco-embed
    volumes:
      # If missing, load data by running start.sh -d
      - ./recco-embed/data:/data
    ports:
      - "8082:80"
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              capabilities: [gpu]
    tty: true

  recco-db:
    image: recco-db
    build:
      context: ./recco-db/
      dockerfile: recco-db.Dockerfile
    container_name: recco-db
    environment:
      - RUN_MODE=development
    volumes:
      - ./recco-db/dev-data/dev-config:/qdrant/config
      # If missing, get data by runing start.sh -d
      - ./recco-db/dev-data/dev-storage:/qdrant/storage
    ports:
      - "6333:6333"
    tty: true 
